<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Studio Satyan</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="has-hamburger admin-body">
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <h1>ADMIN LOGIN</h1>
            <p class="login-intro">Enter the admin password to continue</p>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="password">PASSWORD</label>
                    <input type="password" id="password" name="password" required placeholder="Enter password" autocomplete="current-password">
                </div>
                <p class="login-error hidden" id="loginError">Invalid password. Please try again.</p>
                <button type="submit" class="submit-btn" id="loginBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Content (hidden until authenticated) -->
    <div class="admin-content hidden" id="adminContent">
        <!-- Hamburger Menu -->
        <div class="hamburger-menu">
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="Menu">
                <svg fill="none" viewBox="0 0 24 18">
                    <path clip-rule="evenodd" d="M0 1.5C0 0.67158 0.67158 0 1.5 0H22.5C23.3284 0 24 0.67158 24 1.5C24 2.32842 23.3284 3 22.5 3H1.5C0.67158 3 0 2.32842 0 1.5ZM0 9C0 8.17155 0.67158 7.5 1.5 7.5H22.5C23.3284 7.5 24 8.17155 24 9C24 9.82845 23.3284 10.5 22.5 10.5H1.5C0.67158 10.5 0 9.82845 0 9ZM0 16.5C0 15.6716 0.67158 15 1.5 15H22.5C23.3284 15 24 15.6716 24 16.5C24 17.3284 23.3284 18 22.5 18H1.5C0.67158 18 0 17.3284 0 16.5Z" fill="#090909" fill-rule="evenodd"/>
                </svg>
            </button>
            <div class="hamburger-dropdown" id="hamburgerDropdown">
                <a href="index.html"><p>Home</p></a>
                <a href="about.html"><p>About</p></a>
                <a href="contact.html"><p>Contact</p></a>
            </div>
        </div>

        <!-- Logout Button -->
        <button class="logout-btn" id="logoutBtn" title="Logout">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
        </button>

        <!-- Main Content -->
        <main class="admin-page">
        <div class="admin-container">
            <h1>ADMIN PANEL</h1>
            <p class="admin-intro">Manage your website content</p>

            <!-- Tab Navigation -->
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="collage">Collage Images</button>
                <button class="admin-tab" data-tab="about">About Page</button>
                <button class="admin-tab" data-tab="contact">Contact Page</button>
            </div>

            <!-- Collage Images Section -->
            <section class="admin-section" id="collage-section">
                <h2>COLLAGE IMAGES <span class="image-count" id="imageCount">(0/0)</span></h2>
                <p class="section-desc">Add or remove images from the home page collage. Click the star icon to set an image as the Hero Image.</p>

                <!-- Hero Image Display -->
                <div class="hero-image-display" id="heroImageDisplay">
                    <div class="hero-image-preview" id="heroImagePreview">
                        <img src="" alt="Hero Image" id="heroPreviewImg">
                        <div class="hero-badge">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>
                            HERO
                        </div>
                    </div>
                    <div class="hero-image-info">
                        <p class="hero-label">HERO IMAGE</p>
                        <p class="hero-filename" id="heroFilename">No hero image selected</p>
                        <p class="hero-desc">This image displays first while other images load</p>
                    </div>
                </div>

                <!-- Bulk Actions Bar (hidden when no selection) -->
                <div class="bulk-actions-bar hidden" id="bulkActionsBar">
                    <div class="bulk-select-info">
                        <span id="selectedCount">0</span> selected
                    </div>
                    <div class="bulk-actions">
                        <button class="bulk-btn select-all" id="selectAllBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M9 12l2 2 4-4"/>
                            </svg>
                            Select All
                        </button>
                        <button class="bulk-btn deselect-all" id="deselectAllBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                            </svg>
                            Deselect All
                        </button>
                        <button class="bulk-btn delete-selected" id="deleteSelectedBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Delete Selected
                        </button>
                    </div>
                </div>

                <!-- Upload Area -->
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <p>Drag & drop images here or <span class="upload-link">browse</span></p>
                    <p class="upload-hint">Supports JPG, PNG, WEBP</p>
                    <input type="file" id="imageUpload" accept="image/*" multiple hidden>
                </div>

                <!-- Image Grid -->
                <div class="image-grid" id="imageGrid">
                    <!-- Images will be populated by JavaScript -->
                </div>
            </section>

            <!-- About Page Section -->
            <section class="admin-section hidden" id="about-section">
                <h2>ABOUT PAGE CONTENT</h2>
                <p class="section-desc">Edit the content displayed on the About page.</p>

                <!-- About Image -->
                <div class="form-group">
                    <label>DESIGNER PHOTO</label>
                    <div class="image-preview-container">
                        <img src="_Images/Satyan-About.png" alt="Current designer photo" id="aboutImagePreview">
                        <div class="image-preview-overlay">
                            <button class="change-image-btn" id="changeAboutImage">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                                Change Photo
                            </button>
                        </div>
                    </div>
                    <input type="file" id="aboutImageUpload" accept="image/*" hidden>
                </div>

                <!-- Page Title -->
                <div class="form-group">
                    <label for="aboutTitle">PAGE TITLE</label>
                    <input type="text" id="aboutTitle" value="ABOUT STUDIO SATYAN">
                </div>

                <!-- The Designer Section -->
                <div class="form-group">
                    <label for="designerTitle">THE DESIGNER - HEADING</label>
                    <input type="text" id="designerTitle" value="THE DESIGNER">
                </div>
                <div class="form-group">
                    <label for="designerContent">THE DESIGNER - CONTENT</label>
                    <textarea id="designerContent" rows="6">Studio Satyan represents a bold vision in contemporary footwear design, where traditional craftsmanship meets cutting-edge innovation. Founded by visionary designer Satyan, the studio has become synonymous with boundary-pushing creativity and meticulous attention to detail.

With a deep respect for artisanal techniques and an eye toward the future, every piece tells a story of dedication, precision, and artistic expression.</textarea>
                </div>

                <!-- Philosophy Section -->
                <div class="form-group">
                    <label for="philosophyTitle">PHILOSOPHY - HEADING</label>
                    <input type="text" id="philosophyTitle" value="PHILOSOPHY">
                </div>
                <div class="form-group">
                    <label for="philosophyContent">PHILOSOPHY - CONTENT</label>
                    <textarea id="philosophyContent" rows="6">At Studio Satyan, we believe that footwear is more than just functionâ€”it's an extension of personal identity and artistic expression. Each design is carefully considered, balancing aesthetic innovation with ergonomic excellence.

Our approach combines sustainable practices with premium materials, ensuring that every creation is not only beautiful but also built to last.</textarea>
                </div>

                <!-- Process Section -->
                <div class="form-group">
                    <label for="processTitle">PROCESS - HEADING</label>
                    <input type="text" id="processTitle" value="PROCESS">
                </div>
                <div class="form-group">
                    <label for="processContent">PROCESS - CONTENT</label>
                    <textarea id="processContent" rows="4">From initial sketch to final product, our design process is a journey of exploration and refinement. We work closely with master craftspeople, utilizing both time-honored techniques and modern technology to bring each vision to life.</textarea>
                </div>

                <!-- Contact Info Section -->
                <div class="form-group">
                    <label for="aboutContactTitle">GET IN TOUCH - HEADING</label>
                    <input type="text" id="aboutContactTitle" value="GET IN TOUCH">
                </div>
                <div class="form-group">
                    <label for="aboutContactText">GET IN TOUCH - TEXT</label>
                    <input type="text" id="aboutContactText" value="For inquiries and collaborations:">
                </div>
                <div class="form-group">
                    <label for="aboutEmail">EMAIL</label>
                    <input type="email" id="aboutEmail" value="info@studiosatyan.com">
                </div>

                <button class="save-btn" id="saveAbout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save About Page
                </button>
            </section>

            <!-- Contact Page Section -->
            <section class="admin-section hidden" id="contact-section">
                <h2>CONTACT PAGE CONTENT</h2>
                <p class="section-desc">Edit the content and form settings on the Contact page.</p>

                <!-- Page Header -->
                <div class="form-group">
                    <label for="contactTitle">PAGE TITLE</label>
                    <input type="text" id="contactTitle" value="GET IN TOUCH">
                </div>
                <div class="form-group">
                    <label for="contactIntro">INTRO TEXT</label>
                    <textarea id="contactIntro" rows="2">Have a question or want to collaborate?
Drop us a message and we'll get back to you as soon as possible.</textarea>
                </div>

                <!-- Form Fields Configuration -->
                <h3 class="subsection-title">FORM FIELDS</h3>
                <div class="form-fields-config">
                    <div class="field-config">
                        <div class="field-header">
                            <span class="field-name">Name Field</span>
                            <label class="toggle">
                                <input type="checkbox" id="nameFieldEnabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <input type="text" id="nameFieldLabel" value="NAME *" placeholder="Field Label">
                        <input type="text" id="nameFieldPlaceholder" value="Your name" placeholder="Placeholder">
                    </div>
                    <div class="field-config">
                        <div class="field-header">
                            <span class="field-name">Email Field</span>
                            <label class="toggle">
                                <input type="checkbox" id="emailFieldEnabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <input type="text" id="emailFieldLabel" value="EMAIL *" placeholder="Field Label">
                        <input type="text" id="emailFieldPlaceholder" value="your@email.com" placeholder="Placeholder">
                    </div>
                    <div class="field-config">
                        <div class="field-header">
                            <span class="field-name">Subject Field</span>
                            <label class="toggle">
                                <input type="checkbox" id="subjectFieldEnabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <input type="text" id="subjectFieldLabel" value="SUBJECT *" placeholder="Field Label">
                        <input type="text" id="subjectFieldPlaceholder" value="What is this about?" placeholder="Placeholder">
                    </div>
                    <div class="field-config">
                        <div class="field-header">
                            <span class="field-name">Message Field</span>
                            <label class="toggle">
                                <input type="checkbox" id="messageFieldEnabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <input type="text" id="messageFieldLabel" value="MESSAGE *" placeholder="Field Label">
                        <input type="text" id="messageFieldPlaceholder" value="Tell us more..." placeholder="Placeholder">
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="form-group">
                    <label for="submitBtnText">SUBMIT BUTTON TEXT</label>
                    <input type="text" id="submitBtnText" value="Send Message">
                </div>

                <!-- Success Message -->
                <h3 class="subsection-title">SUCCESS MESSAGE</h3>
                <div class="form-group">
                    <label for="successTitle">SUCCESS TITLE</label>
                    <input type="text" id="successTitle" value="MESSAGE SENT!">
                </div>
                <div class="form-group">
                    <label for="successText">SUCCESS TEXT</label>
                    <input type="text" id="successText" value="Thank you for reaching out. We'll be in touch soon.">
                </div>

                <!-- Contact Info -->
                <h3 class="subsection-title">CONTACT INFORMATION</h3>
                <div class="form-group">
                    <label for="contactEmail">EMAIL</label>
                    <input type="email" id="contactEmail" value="hello@studiosatyan.com">
                </div>
                <div class="form-group">
                    <label for="contactPhone">PHONE</label>
                    <input type="tel" id="contactPhone" value="+1 (555) 123-4567">
                </div>
                <div class="form-group">
                    <label for="contactLocation">LOCATION</label>
                    <input type="text" id="contactLocation" value="New York, NY">
                </div>

                <button class="save-btn" id="saveContact">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Contact Page
                </button>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; STUDIO SATYAN 2025</p>
    </footer>
    </div><!-- End admin-content -->

    <!-- Image Preview Modal -->
    <div class="modal hidden" id="imagePreviewModal">
        <div class="image-preview-modal-content">
            <div class="preview-image-wrapper">
                <img src="" alt="Preview" id="previewImage">
            </div>
            <div class="preview-info">
                <p class="preview-filename" id="previewFilename"></p>
                <p class="preview-dimensions" id="previewDimensions"></p>
            </div>
            <div class="preview-actions">
                <button class="preview-btn delete" id="previewDeleteBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Delete
                </button>
                <button class="preview-btn close" id="previewCloseBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal (single image) -->
    <div class="modal hidden" id="deleteModal">
        <div class="modal-content">
            <h3 class="modal-title">DELETE IMAGE?</h3>
            <p>Are you sure you want to delete this image?</p>
            <div class="modal-buttons">
                <button class="modal-round-btn cancel" id="cancelDelete">
                    <div class="modal-btn-circle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </div>
                    <span class="modal-btn-label">Cancel</span>
                </button>
                <button class="modal-round-btn delete-confirm" id="confirmDelete">
                    <div class="modal-btn-circle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </div>
                    <span class="modal-btn-label">Delete</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Delete Confirmation Modal -->
    <div class="modal hidden" id="bulkDeleteModal">
        <div class="modal-content">
            <h3 class="modal-title">DELETE <span id="bulkDeleteCount">0</span> IMAGES?</h3>
            <p>Are you sure you want to remove the selected images from the collage? This cannot be undone.</p>
            <div class="modal-buttons">
                <button class="modal-round-btn cancel" id="cancelBulkDelete">
                    <div class="modal-btn-circle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </div>
                    <span class="modal-btn-label">Cancel</span>
                </button>
                <button class="modal-round-btn delete-confirm" id="confirmBulkDelete">
                    <div class="modal-btn-circle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </div>
                    <span class="modal-btn-label">Delete All</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span class="toast-message"></span>
    </div>

    <script>
        // ================================
        // AUTHENTICATION
        // ================================
        const loginScreen = document.getElementById('loginScreen');
        const adminContent = document.getElementById('adminContent');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');

        let authToken = localStorage.getItem('adminToken');
        let tokenExpiry = localStorage.getItem('adminTokenExpiry');

        // Check if already authenticated
        async function checkAuth() {
            if (authToken && tokenExpiry && Date.now() < parseInt(tokenExpiry)) {
                // Verify token with server
                try {
                    const response = await fetch('/.netlify/functions/verify-token', {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    if (response.ok) {
                        showAdminContent();
                        return;
                    }
                } catch (e) {
                    console.log('Token verification failed');
                }
            }
            // Clear invalid token
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminTokenExpiry');
            authToken = null;
            showLoginScreen();
        }

        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            adminContent.classList.add('hidden');
        }

        function showAdminContent() {
            loginScreen.classList.add('hidden');
            adminContent.classList.remove('hidden');
            initAdmin();
        }

        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            loginBtn.disabled = true;
            loginBtn.classList.add('loading');
            loginError.classList.add('hidden');

            try {
                const response = await fetch('/.netlify/functions/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    authToken = data.token;
                    const expiry = Date.now() + data.expiresIn;
                    localStorage.setItem('adminToken', authToken);
                    localStorage.setItem('adminTokenExpiry', expiry.toString());
                    showAdminContent();
                } else {
                    loginError.classList.remove('hidden');
                }
            } catch (error) {
                loginError.textContent = 'Connection error. Please try again.';
                loginError.classList.remove('hidden');
            }

            loginBtn.disabled = false;
            loginBtn.classList.remove('loading');
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminTokenExpiry');
            authToken = null;
            document.getElementById('password').value = '';
            showLoginScreen();
            showToast('Logged out successfully');
        });

        // Initialize on page load
        checkAuth();

        // ================================
        // ADMIN INITIALIZATION
        // ================================
        function initAdmin() {
            // Hamburger menu toggle
            document.getElementById('hamburgerBtn').addEventListener('click', function() {
                document.getElementById('hamburgerDropdown').classList.toggle('open');
            });
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.hamburger-menu')) {
                    document.getElementById('hamburgerDropdown').classList.remove('open');
                }
            });

            // Tab Navigation
            const tabs = document.querySelectorAll('.admin-tab');
            const sections = document.querySelectorAll('.admin-section');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;

                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // Show corresponding section
                    sections.forEach(section => {
                        section.classList.add('hidden');
                        if (section.id === `${targetTab}-section`) {
                            section.classList.remove('hidden');
                        }
                    });
                });
            });

            // Load content from server
            loadServerContent();
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = toast.querySelector('.toast-message');
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;

            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // ================================
        // COLLAGE IMAGE MANAGEMENT
        // ================================

        // Image path prefix
        const IMAGE_PATH_PREFIX = '_Images/Home-Collage/';

        // Default images from _Images/Home-Collage/ (with full paths for server storage)
        const defaultCollageImages = [
            '_Images/Home-Collage/hero-1.png',
            '_Images/Home-Collage/44c931601f5cd938be7f14ea40ce9f15.jpeg',
            '_Images/Home-Collage/484d4d30-7464-4d13-a928-63556b1a2bbd.jpeg',
            '_Images/Home-Collage/522847C5-37E2-4342-A104-0CF1EDB7179A.jpeg',
            '_Images/Home-Collage/5479ec54-2926-408d-8f77-1a8165f09939.jpeg',
            '_Images/Home-Collage/56642875880__73CE31CD-B414-4A49-BC85-C61C33189B9A.jpeg',
            '_Images/Home-Collage/58888336679__0C0F3E01-6CEA-4934-919E-E7EDB16429DB.jpeg',
            '_Images/Home-Collage/626af402-4e3c-4cb9-b3a7-2ca376076c9f.jpeg',
            '_Images/Home-Collage/72220589324__AF576498-CAE7-43AD-A3BE-D90CB4BDE137.jpeg',
            '_Images/Home-Collage/843ac80c-7d99-457e-b06c-e73479fad93f.jpeg',
            '_Images/Home-Collage/A715D6ED-2551-4A95-95DF-3B8DF02D5BB8.jpeg',
            '_Images/Home-Collage/afd4ac2f-23f1-466b-a105-39d211c1beff.jpeg',
            '_Images/Home-Collage/c3f8d966-26f8-40c2-9dd7-5f5e5fc804b7.jpeg',
            '_Images/Home-Collage/cf36a9f84bd09b7cf065ad38b32a9969.jpeg',
            '_Images/Home-Collage/color perspective.jpeg',
            '_Images/Home-Collage/corre 2 botinha.273.jpeg',
            '_Images/Home-Collage/e2106001-b1d4-499e-8d1c-36d648d56501.jpeg',
            '_Images/Home-Collage/FOAM SHOE Heel Tan.979.png',
            '_Images/Home-Collage/IMG_0104.jpeg',
            '_Images/Home-Collage/IMG_0253.jpeg',
            '_Images/Home-Collage/IMG_0315.jpeg',
            '_Images/Home-Collage/IMG_0389.jpeg',
            '_Images/Home-Collage/IMG_0530.jpeg',
            '_Images/Home-Collage/IMG_0556.jpeg',
            '_Images/Home-Collage/IMG_0628.jpeg',
            '_Images/Home-Collage/IMG_0654.jpeg',
            '_Images/Home-Collage/IMG_0829.jpeg',
            '_Images/Home-Collage/IMG_0980.jpeg',
            '_Images/Home-Collage/IMG_1281.jpeg',
            '_Images/Home-Collage/IMG_1574.jpeg',
            '_Images/Home-Collage/IMG_2028.jpeg',
            '_Images/Home-Collage/IMG_2184.jpeg',
            '_Images/Home-Collage/IMG_2284.jpeg',
            '_Images/Home-Collage/IMG_2285.jpeg',
            '_Images/Home-Collage/IMG_2286.jpeg',
            '_Images/Home-Collage/IMG_3083.jpeg',
            '_Images/Home-Collage/IMG_4777.jpeg',
            '_Images/Home-Collage/IMG_5141.jpeg',
            '_Images/Home-Collage/IMG_6036.jpeg',
            '_Images/Home-Collage/IMG_6062.jpeg',
            '_Images/Home-Collage/IMG_7053.jpeg',
            '_Images/Home-Collage/IMG_9133.jpeg'
        ];

        // Active collage images (will be loaded from server or defaults)
        let collageImages = [...defaultCollageImages];

        // Hero image (first image by default)
        let heroImage = defaultCollageImages[0];

        // Selected images for bulk operations
        let selectedImages = new Set();

        // Get filename from full path
        function getFilename(path) {
            return path.replace(IMAGE_PATH_PREFIX, '');
        }

        // Save collage images to server (includes hero designation)
        async function saveCollageImages() {
            // Save as object with hero and images array
            const collageData = {
                hero: heroImage,
                images: collageImages
            };
            const success = await saveToServer('collage-images', collageData);
            if (success) {
                showToast('Collage images saved to server');
            }
            return success;
        }

        // Update hero image display
        function updateHeroDisplay() {
            const heroPreviewImg = document.getElementById('heroPreviewImg');
            const heroFilename = document.getElementById('heroFilename');
            const heroDisplay = document.getElementById('heroImageDisplay');

            if (heroImage) {
                const imageSrc = encodeURIComponent(heroImage).replace(/%2F/g, '/');
                heroPreviewImg.src = imageSrc;
                heroFilename.textContent = getFilename(heroImage);
                heroDisplay.classList.remove('no-hero');
            } else {
                heroPreviewImg.src = '';
                heroFilename.textContent = 'No hero image selected';
                heroDisplay.classList.add('no-hero');
            }
        }

        // Set image as hero
        async function setAsHero(imagePath) {
            heroImage = imagePath;
            updateHeroDisplay();
            renderImageGrid(); // Re-render to update star icons
            await saveCollageImages();
            showToast(`Hero image set: ${getFilename(imagePath)}`);
        }

        const imageGrid = document.getElementById('imageGrid');
        const uploadArea = document.getElementById('uploadArea');
        const imageUpload = document.getElementById('imageUpload');
        const deleteModal = document.getElementById('deleteModal');
        const imagePreviewModal = document.getElementById('imagePreviewModal');
        const previewImage = document.getElementById('previewImage');
        const previewFilename = document.getElementById('previewFilename');
        const previewDimensions = document.getElementById('previewDimensions');
        const imageCountEl = document.getElementById('imageCount');
        let originalImageCount = defaultCollageImages.length; // Store original count
        let imageToDelete = null;
        let currentPreviewIndex = null;

        // Update image count display
        function updateImageCount() {
            imageCountEl.textContent = `(${collageImages.length}/${originalImageCount})`;
        }

        // Update bulk actions bar visibility
        function updateBulkActionsBar() {
            const bulkActionsBar = document.getElementById('bulkActionsBar');
            const selectedCountEl = document.getElementById('selectedCount');

            if (selectedImages.size > 0) {
                bulkActionsBar.classList.remove('hidden');
                selectedCountEl.textContent = selectedImages.size;
            } else {
                bulkActionsBar.classList.add('hidden');
            }
        }

        // Toggle image selection
        function toggleImageSelection(imagePath) {
            if (selectedImages.has(imagePath)) {
                selectedImages.delete(imagePath);
            } else {
                selectedImages.add(imagePath);
            }
            // Update UI
            const card = document.querySelector(`.image-card[data-path="${imagePath}"]`);
            if (card) {
                card.classList.toggle('selected', selectedImages.has(imagePath));
                const checkbox = card.querySelector('.select-checkbox');
                if (checkbox) {
                    checkbox.classList.toggle('checked', selectedImages.has(imagePath));
                }
            }
            updateBulkActionsBar();
        }

        // Clear all selections
        function clearAllSelections() {
            selectedImages.clear();
            document.querySelectorAll('.image-card.selected').forEach(card => {
                card.classList.remove('selected');
                const checkbox = card.querySelector('.select-checkbox');
                if (checkbox) checkbox.classList.remove('checked');
            });
            updateBulkActionsBar();
        }

        // Select all images
        function selectAllImages() {
            collageImages.forEach(imagePath => {
                selectedImages.add(imagePath);
            });
            document.querySelectorAll('.image-card').forEach(card => {
                card.classList.add('selected');
                const checkbox = card.querySelector('.select-checkbox');
                if (checkbox) checkbox.classList.add('checked');
            });
            updateBulkActionsBar();
        }

        // Render image grid
        function renderImageGrid() {
            imageGrid.innerHTML = '';
            collageImages.forEach((imagePath, index) => {
                const filename = getFilename(imagePath);
                const isHero = imagePath === heroImage;
                const isSelected = selectedImages.has(imagePath);
                const imageCard = document.createElement('div');
                imageCard.className = `image-card${isHero ? ' is-hero' : ''}${isSelected ? ' selected' : ''}`;
                imageCard.dataset.index = index;
                imageCard.dataset.path = imagePath;
                imageCard.innerHTML = `
                    <img src="${encodeURIComponent(imagePath).replace(/%2F/g, '/')}" alt="${filename}" loading="lazy">
                    <button class="hero-star-btn${isHero ? ' active' : ''}" data-path="${imagePath}" title="${isHero ? 'Current hero image' : 'Set as hero image'}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="${isHero ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                    </button>
                    <div class="select-checkbox${isSelected ? ' checked' : ''}" data-path="${imagePath}" title="Select for bulk actions">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                    <div class="image-overlay">
                        <span class="image-name">${filename}</span>
                    </div>
                `;
                imageGrid.appendChild(imageCard);
            });

            // Add click listeners for hero star buttons
            document.querySelectorAll('.hero-star-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card click
                    const path = btn.dataset.path;
                    if (path !== heroImage) {
                        setAsHero(path);
                    }
                });
            });

            // Add click listeners for select checkboxes
            document.querySelectorAll('.select-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card click
                    const path = checkbox.dataset.path;
                    toggleImageSelection(path);
                });
            });

            // Add click listeners to image cards for preview
            document.querySelectorAll('.image-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Don't open preview if clicking the star button or checkbox
                    if (e.target.closest('.hero-star-btn') || e.target.closest('.select-checkbox')) return;
                    const index = parseInt(card.dataset.index);
                    openImagePreview(index);
                });
            });

            // Update image count and hero display
            updateImageCount();
            updateHeroDisplay();
            updateBulkActionsBar();
        }

        // Open image preview modal
        function openImagePreview(index) {
            currentPreviewIndex = index;
            const imagePath = collageImages[index];
            const filename = getFilename(imagePath);
            const imageSrc = encodeURIComponent(imagePath).replace(/%2F/g, '/');

            previewImage.src = imageSrc;
            previewFilename.textContent = filename;
            previewDimensions.textContent = 'Loading dimensions...';

            // Get actual image dimensions
            const img = new Image();
            img.onload = function() {
                previewDimensions.textContent = `${this.naturalWidth} x ${this.naturalHeight} px`;
            };
            img.onerror = function() {
                previewDimensions.textContent = 'Unable to load dimensions';
            };
            img.src = imageSrc;

            imagePreviewModal.classList.remove('hidden');
        }

        // Close image preview modal
        function closeImagePreview() {
            imagePreviewModal.classList.add('hidden');
            currentPreviewIndex = null;
        }

        // Preview modal event listeners
        document.getElementById('previewCloseBtn').addEventListener('click', closeImagePreview);

        document.getElementById('previewDeleteBtn').addEventListener('click', () => {
            if (currentPreviewIndex !== null) {
                imageToDelete = currentPreviewIndex;
                closeImagePreview();
                deleteModal.classList.remove('hidden');
            }
        });

        imagePreviewModal.addEventListener('click', (e) => {
            if (e.target === imagePreviewModal) {
                closeImagePreview();
            }
        });

        // Initialize image grid
        renderImageGrid();

        // Upload area interactions
        uploadArea.addEventListener('click', () => imageUpload.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        imageUpload.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            let addedCount = 0;
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    // Add with full path prefix
                    const fullPath = IMAGE_PATH_PREFIX + file.name;
                    collageImages.push(fullPath);
                    showToast(`Added: ${file.name}`);
                    addedCount++;
                }
            });
            if (addedCount > 0) {
                renderImageGrid();
                // Save to server
                await saveCollageImages();
            }
        }

        // Delete modal interactions
        document.getElementById('cancelDelete').addEventListener('click', () => {
            deleteModal.classList.add('hidden');
            imageToDelete = null;
        });

        document.getElementById('confirmDelete').addEventListener('click', async () => {
            if (imageToDelete !== null) {
                const imagePath = collageImages[imageToDelete];
                const filename = getFilename(imagePath);

                // If deleting the hero image, set new hero to first remaining image
                if (imagePath === heroImage) {
                    collageImages.splice(imageToDelete, 1);
                    heroImage = collageImages.length > 0 ? collageImages[0] : null;
                } else {
                    collageImages.splice(imageToDelete, 1);
                }

                renderImageGrid();
                showToast(`Deleted: ${filename}`);
                // Save to server
                await saveCollageImages();
            }
            deleteModal.classList.add('hidden');
            imageToDelete = null;
        });

        // Close modal on backdrop click
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.add('hidden');
                imageToDelete = null;
            }
        });

        // ================================
        // BULK DELETE FUNCTIONALITY
        // ================================

        const bulkDeleteModal = document.getElementById('bulkDeleteModal');

        // Select All button
        document.getElementById('selectAllBtn').addEventListener('click', selectAllImages);

        // Deselect All button
        document.getElementById('deselectAllBtn').addEventListener('click', clearAllSelections);

        // Delete Selected button - opens confirmation modal
        document.getElementById('deleteSelectedBtn').addEventListener('click', () => {
            if (selectedImages.size > 0) {
                document.getElementById('bulkDeleteCount').textContent = selectedImages.size;
                bulkDeleteModal.classList.remove('hidden');
            }
        });

        // Cancel bulk delete
        document.getElementById('cancelBulkDelete').addEventListener('click', () => {
            bulkDeleteModal.classList.add('hidden');
        });

        // Confirm bulk delete
        document.getElementById('confirmBulkDelete').addEventListener('click', async () => {
            const deletedCount = selectedImages.size;

            // Remove selected images from array
            collageImages = collageImages.filter(img => !selectedImages.has(img));

            // If hero was deleted, set new hero
            if (selectedImages.has(heroImage)) {
                heroImage = collageImages.length > 0 ? collageImages[0] : null;
            }

            // Clear selections
            selectedImages.clear();

            // Close modal and re-render
            bulkDeleteModal.classList.add('hidden');
            renderImageGrid();

            // Save to server
            await saveCollageImages();
            showToast(`Deleted ${deletedCount} image${deletedCount > 1 ? 's' : ''}`);
        });

        // Close bulk delete modal on backdrop click
        bulkDeleteModal.addEventListener('click', (e) => {
            if (e.target === bulkDeleteModal) {
                bulkDeleteModal.classList.add('hidden');
            }
        });

        // ================================
        // ABOUT PAGE MANAGEMENT
        // ================================

        const aboutImageUpload = document.getElementById('aboutImageUpload');
        const aboutImagePreview = document.getElementById('aboutImagePreview');
        const changeAboutImage = document.getElementById('changeAboutImage');

        changeAboutImage.addEventListener('click', () => aboutImageUpload.click());

        aboutImageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    aboutImagePreview.src = e.target.result;
                    showToast('Image updated - remember to save!');
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('saveAbout').addEventListener('click', async () => {
            // Collect all about page data
            const aboutData = {
                title: document.getElementById('aboutTitle').value,
                designer: {
                    title: document.getElementById('designerTitle').value,
                    content: document.getElementById('designerContent').value
                },
                philosophy: {
                    title: document.getElementById('philosophyTitle').value,
                    content: document.getElementById('philosophyContent').value
                },
                process: {
                    title: document.getElementById('processTitle').value,
                    content: document.getElementById('processContent').value
                },
                contact: {
                    title: document.getElementById('aboutContactTitle').value,
                    text: document.getElementById('aboutContactText').value,
                    email: document.getElementById('aboutEmail').value
                }
            };

            // Save to server
            const success = await saveToServer('about-page', aboutData);
            if (success) {
                showToast('About page saved successfully!');
            } else {
                showToast('Failed to save. Please try again.', 'error');
            }
        });

        // Load about data from form fields (populated by loadServerContent)
        function loadAboutData(data) {
            if (!data) return;
            document.getElementById('aboutTitle').value = data.title || '';
            document.getElementById('designerTitle').value = data.designer?.title || '';
            document.getElementById('designerContent').value = data.designer?.content || '';
            document.getElementById('philosophyTitle').value = data.philosophy?.title || '';
            document.getElementById('philosophyContent').value = data.philosophy?.content || '';
            document.getElementById('processTitle').value = data.process?.title || '';
            document.getElementById('processContent').value = data.process?.content || '';
            document.getElementById('aboutContactTitle').value = data.contact?.title || '';
            document.getElementById('aboutContactText').value = data.contact?.text || '';
            document.getElementById('aboutEmail').value = data.contact?.email || '';
        }

        // ================================
        // CONTACT PAGE MANAGEMENT
        // ================================

        document.getElementById('saveContact').addEventListener('click', async () => {
            // Collect all contact page data
            const contactData = {
                title: document.getElementById('contactTitle').value,
                intro: document.getElementById('contactIntro').value,
                fields: {
                    name: {
                        enabled: document.getElementById('nameFieldEnabled').checked,
                        label: document.getElementById('nameFieldLabel').value,
                        placeholder: document.getElementById('nameFieldPlaceholder').value
                    },
                    email: {
                        enabled: document.getElementById('emailFieldEnabled').checked,
                        label: document.getElementById('emailFieldLabel').value,
                        placeholder: document.getElementById('emailFieldPlaceholder').value
                    },
                    subject: {
                        enabled: document.getElementById('subjectFieldEnabled').checked,
                        label: document.getElementById('subjectFieldLabel').value,
                        placeholder: document.getElementById('subjectFieldPlaceholder').value
                    },
                    message: {
                        enabled: document.getElementById('messageFieldEnabled').checked,
                        label: document.getElementById('messageFieldLabel').value,
                        placeholder: document.getElementById('messageFieldPlaceholder').value
                    }
                },
                submitBtn: document.getElementById('submitBtnText').value,
                success: {
                    title: document.getElementById('successTitle').value,
                    text: document.getElementById('successText').value
                },
                info: {
                    email: document.getElementById('contactEmail').value,
                    phone: document.getElementById('contactPhone').value,
                    location: document.getElementById('contactLocation').value
                }
            };

            // Save to server
            const success = await saveToServer('contact-page', contactData);
            if (success) {
                showToast('Contact page saved successfully!');
            } else {
                showToast('Failed to save. Please try again.', 'error');
            }
        });

        // Load contact data from form fields (populated by loadServerContent)
        function loadContactData(data) {
            if (!data) return;
            document.getElementById('contactTitle').value = data.title || '';
            document.getElementById('contactIntro').value = data.intro || '';

            if (data.fields) {
                document.getElementById('nameFieldEnabled').checked = data.fields.name?.enabled ?? true;
                document.getElementById('nameFieldLabel').value = data.fields.name?.label || '';
                document.getElementById('nameFieldPlaceholder').value = data.fields.name?.placeholder || '';

                document.getElementById('emailFieldEnabled').checked = data.fields.email?.enabled ?? true;
                document.getElementById('emailFieldLabel').value = data.fields.email?.label || '';
                document.getElementById('emailFieldPlaceholder').value = data.fields.email?.placeholder || '';

                document.getElementById('subjectFieldEnabled').checked = data.fields.subject?.enabled ?? true;
                document.getElementById('subjectFieldLabel').value = data.fields.subject?.label || '';
                document.getElementById('subjectFieldPlaceholder').value = data.fields.subject?.placeholder || '';

                document.getElementById('messageFieldEnabled').checked = data.fields.message?.enabled ?? true;
                document.getElementById('messageFieldLabel').value = data.fields.message?.label || '';
                document.getElementById('messageFieldPlaceholder').value = data.fields.message?.placeholder || '';
            }

            document.getElementById('submitBtnText').value = data.submitBtn || '';
            document.getElementById('successTitle').value = data.success?.title || '';
            document.getElementById('successText').value = data.success?.text || '';
            document.getElementById('contactEmail').value = data.info?.email || '';
            document.getElementById('contactPhone').value = data.info?.phone || '';
            document.getElementById('contactLocation').value = data.info?.location || '';
        }

        // ================================
        // SERVER COMMUNICATION
        // ================================

        // Save to server
        async function saveToServer(type, data) {
            try {
                const response = await fetch('/.netlify/functions/save-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ type, data })
                });
                return response.ok;
            } catch (error) {
                console.error('Save error:', error);
                return false;
            }
        }

        // Load content from server
        async function loadServerContent() {
            try {
                const response = await fetch('/.netlify/functions/get-content');
                if (response.ok) {
                    const content = await response.json();

                    // Load about page data
                    if (content.about) {
                        loadAboutData(content.about);
                    }

                    // Load contact page data
                    if (content.contact) {
                        loadContactData(content.contact);
                    }

                    // Load collage images (if stored)
                    if (content.collage) {
                        // Handle both old format (array) and new format (object with hero and images)
                        if (content.collage.images && Array.isArray(content.collage.images)) {
                            // New format with hero
                            collageImages.length = 0;
                            collageImages.push(...content.collage.images);
                            heroImage = content.collage.hero || collageImages[0] || null;
                        } else if (Array.isArray(content.collage) && content.collage.length > 0) {
                            // Old format (just array)
                            collageImages.length = 0;
                            collageImages.push(...content.collage);
                            heroImage = collageImages[0] || null;
                        }
                        originalImageCount = collageImages.length;
                        renderImageGrid();
                    }
                }
            } catch (error) {
                console.log('Could not load server content, using defaults');
            }
        }
    </script>
</body>
</html>
